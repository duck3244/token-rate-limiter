graph TB
    %% ì™¸ë¶€ ì¸í„°í˜ì´ìŠ¤
    subgraph "External Interface"
        API[REST API<br/>ğŸ“¡ /api/v1/models]
        Admin[Admin API<br/>âš™ï¸ /api/v1/admin]
        Actuator[Actuator<br/>ğŸ¥ /actuator]
    end
    
    %% ì›¹ ê³„ì¸µ
    subgraph "Web Layer"
        Filter[TokenRateLimitFilter<br/>ğŸ›¡ï¸ Request Filtering]
        Router[ModelProxyRouter<br/>ğŸ”€ Request Routing]
        Controller[TokenUsageController<br/>ğŸ“Š Admin Operations]
        ExceptionHandler[GlobalExceptionHandler<br/>âš ï¸ Error Handling]
    end
    
    %% ì„œë¹„ìŠ¤ ê³„ì¸µ
    subgraph "Service Layer"
        RateLimitService[TokenRateLimitService<br/>ğŸš¦ Rate Limiting Logic]
        ProxyService[ModelProxyService<br/>ğŸ”„ Model Proxy]
        RegistryService[ModelRegistryService<br/>ğŸ“‹ Model Registry]
    end
    
    %% ë°ì´í„° ê³„ì¸µ
    subgraph "Data Layer"
        RedisConfig[RedisConfig<br/>âš™ï¸ Redis Configuration]
        RedisTemplate[RedisTemplate<br/>ğŸ’¾ Data Access]
    end
    
    %% ëª¨ë‹ˆí„°ë§ ê³„ì¸µ
    subgraph "Monitoring Layer"
        Metrics[TokenUsageMetrics<br/>ğŸ“ˆ Metrics Collection]
        ScheduledTasks[ScheduledTasks<br/>â° Background Jobs]
    end
    
    %% ì„¤ì • ê³„ì¸µ
    subgraph "Configuration Layer"
        RateLimitConfig[TokenRateLimitConfig<br/>âš™ï¸ Rate Limit Settings]
        WebConfig[WebConfig<br/>ğŸŒ Web Configuration]
    end
    
    %% ì™¸ë¶€ ì‹œìŠ¤í…œ
    subgraph "External Systems"
        Redis[(Redis<br/>ğŸ’¾ Cache)]
        vLLM1[vLLM Llama2-7B<br/>ğŸ¤– Model Server]
        vLLM2[vLLM Llama2-13B<br/>ğŸ¤– Model Server]
        vLLM3[vLLM GPT-3.5<br/>ğŸ¤– Model Server]
        Prometheus[Prometheus<br/>ğŸ“Š Metrics Storage]
    end
    
    %% ì—°ê²° ê´€ê³„ - ì™¸ë¶€ì—ì„œ ì›¹ ê³„ì¸µìœ¼ë¡œ
    API --> Filter
    API --> Router
    Admin --> Controller
    Actuator --> Metrics
    
    %% ì›¹ ê³„ì¸µ ë‚´ë¶€ ì—°ê²°
    Filter --> Router
    Router --> ExceptionHandler
    Controller --> ExceptionHandler
    
    %% ì›¹ ê³„ì¸µì—ì„œ ì„œë¹„ìŠ¤ ê³„ì¸µìœ¼ë¡œ
    Filter --> RateLimitService
    Router --> ProxyService
    Controller --> RateLimitService
    
    %% ì„œë¹„ìŠ¤ ê³„ì¸µ ë‚´ë¶€ ì—°ê²°
    ProxyService --> RateLimitService
    ProxyService --> RegistryService
    
    %% ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ë°ì´í„° ê³„ì¸µìœ¼ë¡œ
    RateLimitService --> RedisTemplate
    RegistryService --> RedisTemplate
    
    %% ë°ì´í„° ê³„ì¸µì—ì„œ ì™¸ë¶€ ì‹œìŠ¤í…œìœ¼ë¡œ
    RedisTemplate --> Redis
    
    %% ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì™¸ë¶€ ëª¨ë¸ ì„œë²„ë¡œ
    ProxyService --> vLLM1
    ProxyService --> vLLM2
    ProxyService --> vLLM3
    
    %% ëª¨ë‹ˆí„°ë§ ì—°ê²°
    RateLimitService --> Metrics
    ProxyService --> Metrics
    Metrics --> Prometheus
    ScheduledTasks --> RedisTemplate
    ScheduledTasks --> Metrics
    
    %% ì„¤ì • ì—°ê²°
    RateLimitConfig --> RateLimitService
    WebConfig --> Router
    RedisConfig --> RedisTemplate
    
    %% ìŠ¤íƒ€ì¼ë§
    classDef webStyle fill:#e3f2fd,stroke:#0277bd,stroke-width:2px
    classDef serviceStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef dataStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef monitorStyle fill:#fff8e1,stroke:#f57c00,stroke-width:2px
    classDef configStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef externalStyle fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef interfaceStyle fill:#f1f8e9,stroke:#689f38,stroke-width:2px
    
    class Filter,Router,Controller,ExceptionHandler webStyle
    class RateLimitService,ProxyService,RegistryService serviceStyle
    class RedisConfig,RedisTemplate dataStyle
    class Metrics,ScheduledTasks monitorStyle
    class RateLimitConfig,WebConfig configStyle
    class Redis,vLLM1,vLLM2,vLLM3,Prometheus externalStyle
    class API,Admin,Actuator interfaceStyle